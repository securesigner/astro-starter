---
/**
 * BlogCard Component
 * ==================
 * A card component for displaying blog post previews with optional thumbnail.
 * Features:
 * - Optional thumbnail image on the left
 * - Fallback gradient for posts without images
 * - Lazy loaded images with automatic WebP conversion
 * - Glass morphism styling
 * - Responsive layout
 */

import { Image } from 'astro:assets';

interface Props {
  title: string;
  slug: string;
  date: Date;
  excerpt?: string;
  description?: string;
  author?: string;
  categories?: string[];
  image?: {
    src: string;
    alt?: string;
  };
  /** Make this card span multiple columns (featured) */
  featured?: boolean;
}

const {
  title,
  slug,
  date,
  excerpt,
  description,
  author = 'Your Name',
  categories = [],
  image,
  featured = false,
} = Astro.props;

// Format date helper
function formatDate(date: Date): string {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
}

// Generate a deterministic gradient based on title for fallback
function generateGradient(title: string): string {
  // Simple hash function to get consistent gradients
  let hash = 0;
  for (let i = 0; i < title.length; i++) {
    hash = title.charCodeAt(i) + ((hash << 5) - hash);
  }

  // Use hash to pick from curated gradient pairs (brand-consistent: emerald, teal, amber)
  const gradients = [
    'from-accent-primary/30 to-accent-secondary/20',
    'from-accent-secondary/30 to-accent-primary/20',
    'from-emerald-500/25 to-teal-500/20',
    'from-teal-500/25 to-emerald-500/20',
    'from-amber-400/25 to-emerald-500/20',
    'from-emerald-500/25 to-amber-400/20',
  ];

  const index = Math.abs(hash) % gradients.length;
  return gradients[index];
}

const gradientClass = generateGradient(title);
const displayText = excerpt || description;
---

<article
  class:list={[
    'group relative bg-glass-bg backdrop-blur-md border border-glass-border rounded-lg overflow-hidden transition-all duration-300',
    'hover:border-accent-primary/50 hover:shadow-lg hover:shadow-accent-primary/10',
    featured && 'md:col-span-2 lg:col-span-2',
  ]}
>
  <a
    href={`/blog/${slug}/`}
    class:list={[
      'flex h-full',
      image ? 'flex-col sm:flex-row' : 'flex-col',
    ]}
  >
    <!-- Thumbnail or Gradient Fallback -->
    <div
      class:list={[
        'relative shrink-0 overflow-hidden',
        image
          ? featured
            ? 'h-48 sm:h-auto sm:w-64 lg:w-80'
            : 'h-40 sm:h-auto sm:w-40 lg:w-48'
          : 'h-24 sm:h-32',
      ]}
    >
      {image ? (
        <Image
          src={image.src}
          alt={image.alt || title}
          width={320}
          height={200}
          loading="lazy"
          decoding="async"
          format="webp"
          class="absolute inset-0 w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
        />
      ) : (
        <div
          class={`absolute inset-0 bg-linear-to-br ${gradientClass} flex items-center justify-center`}
        >
          <!-- Decorative pattern overlay -->
          <div class="absolute inset-0 opacity-10 bg-[radial-gradient(circle_at_1px_1px,_currentColor_1px,_transparent_0)] bg-[size:20px_20px]" />
          <!-- Icon placeholder -->
          <svg
            class="w-10 h-10 text-fg-muted/40"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="1.5"
              d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"
            />
          </svg>
        </div>
      )}
    </div>

    <!-- Content -->
    <div class="flex flex-col flex-1 p-5 sm:p-6">
      <!-- Categories -->
      {categories.length > 0 && (
        <div class="flex flex-wrap gap-2 mb-3">
          {categories.slice(0, 2).map((cat) => (
            <span class="px-2 py-0.5 bg-accent-primary/20 text-accent-primary-light font-mono text-xs font-bold uppercase tracking-wide rounded">
              {cat}
            </span>
          ))}
        </div>
      )}

      <!-- Title -->
      <h2
        class:list={[
          'font-mono font-bold text-fg-bold group-hover:text-accent-primary-light transition-colors mb-3',
          featured ? 'text-2xl md:text-3xl' : 'text-lg sm:text-xl',
        ]}
      >
        {title}
      </h2>

      <!-- Excerpt -->
      {displayText && (
        <p class="text-fg-light text-sm leading-relaxed mb-4 line-clamp-3 flex-1">
          {displayText}
        </p>
      )}

      <!-- Meta -->
      <div class="flex items-center gap-3 text-fg-muted text-xs font-mono mt-auto pt-4 border-t border-glass-border/50">
        <time datetime={date.toISOString()}>
          {formatDate(date)}
        </time>
        <span class="text-accent-primary/50">â€¢</span>
        <span>{author}</span>
      </div>

      <!-- Read more indicator -->
      <div class="absolute bottom-5 right-5 sm:bottom-6 sm:right-6 opacity-0 group-hover:opacity-100 transition-opacity">
        <span class="text-accent-primary-light font-mono text-sm flex items-center gap-1">
          Read
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
          </svg>
        </span>
      </div>
    </div>
  </a>
</article>

<style>
  /* Line clamp utility */
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
